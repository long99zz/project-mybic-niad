// Mục đích sử dụng và Phí bảo hiểm TNDS
export const CAR_INSURANCE_DATA = [
  {
    usage: "Xe ô tô không kinh doanh vận tải",
    label: "Xe ô tô không kinh doanh vận tải",
    vehicleTypes: [
      {
        value: "Xe dưới 6 chỗ ngồi",
        label: "Xe dưới 6 chỗ ngồi",
        baseFeeTNDS: 437000,
      },
      {
        value: "Xe từ 6 chỗ tới 11 chỗ",
        label: "Xe từ 6 chỗ tới 11 chỗ",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe từ 12 chỗ tới 24 chỗ",
        label: "Xe từ 12 chỗ tới 24 chỗ",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe trên 24 chỗ",
        label: "Xe trên 24 chỗ",
        baseFeeTNDS: 1734000,
      },
      {
        value: "Xe vừa chở người vừa chở hàng (Pickup, minivan)",
        label: "Xe vừa chở người vừa chở hàng (Pickup, minivan)",
        baseFeeTNDS: 437000,
      },
    ],
  },
  {
    usage: "Xe ô tô kinh doanh vận tải",
    label: "Xe ô tô kinh doanh vận tải",
    vehicleTypes: [
      {
        value: "Xe dưới 6 chỗ ngồi",
        label: "Xe dưới 6 chỗ ngồi",
        baseFeeTNDS: 437000,
      },
      {
        value: "Xe 6 chỗ ngồi theo đăng ký",
        label: "Xe 6 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 7 chỗ ngồi theo đăng ký",
        label: "Xe 7 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 8 chỗ ngồi theo đăng ký",
        label: "Xe 8 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 9 chỗ ngồi theo đăng ký",
        label: "Xe 9 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 10 chỗ ngồi theo đăng ký",
        label: "Xe 10 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 11 chỗ ngồi theo đăng ký",
        label: "Xe 11 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 12 chỗ ngồi theo đăng ký",
        label: "Xe 12 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 13 chỗ ngồi theo đăng ký",
        label: "Xe 13 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 14 chỗ ngồi theo đăng ký",
        label: "Xe 14 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 15 chỗ ngồi theo đăng ký",
        label: "Xe 15 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 16 chỗ ngồi theo đăng ký",
        label: "Xe 16 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 17 chỗ ngồi theo đăng ký",
        label: "Xe 17 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 18 chỗ ngồi theo đăng ký",
        label: "Xe 18 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 19 chỗ ngồi theo đăng ký",
        label: "Xe 19 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 20 chỗ ngồi theo đăng ký",
        label: "Xe 20 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 21 chỗ ngồi theo đăng ký",
        label: "Xe 21 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 22 chỗ ngồi theo đăng ký",
        label: "Xe 22 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 23 chỗ ngồi theo đăng ký",
        label: "Xe 23 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 24 chỗ ngồi theo đăng ký",
        label: "Xe 24 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe trên 24 chỗ",
        label: "Xe trên 24 chỗ",
        baseFeeTNDS: 1734000,
      },
      { value: "Xe Bus", label: "Xe Bus", baseFeeTNDS: 1734000 },
      { value: "Xe tải Van", label: "Xe tải Van", baseFeeTNDS: 938000 },
      { value: "Xe Pickup", label: "Xe Pickup", baseFeeTNDS: 938000 },
    ],
  },
  {
    usage: "Xe Bus",
    label: "Xe Bus",
    vehicleTypes: [
      {
        value: "Xe trên 24 chỗ",
        label: "Xe trên 24 chỗ",
        baseFeeTNDS: 1734000,
      },
    ],
  },
  {
    usage: "Xe Tải (bao gồm xe Pickup, Van tải)",
    label: "Xe Tải (bao gồm xe Pickup, Van tải)",
    vehicleTypes: [
      { value: "<= 3 tấn", label: "<= 3 tấn", baseFeeTNDS: 938000 },
      {
        value: "> 3 tấn đến 7 tấn",
        label: "> 3 tấn đến 7 tấn",
        baseFeeTNDS: 1498000,
      },
      {
        value: "> 7 tấn đến 15 tấn",
        label: "> 7 tấn đến 15 tấn",
        baseFeeTNDS: 3079000,
      },
      { value: "> 15 tấn", label: "> 15 tấn", baseFeeTNDS: 3970000 },
      {
        value: "Xe đầu kéo rơ-moóc",
        label: "Xe đầu kéo rơ-moóc",
        baseFeeTNDS: 4718000,
      },
    ],
  },
  {
    usage: "Xe taxi",
    label: "Xe taxi",
    vehicleTypes: [
      {
        value: "Xe dưới 6 chỗ ngồi",
        label: "Xe dưới 6 chỗ ngồi",
        baseFeeTNDS: 437000,
      },
      {
        value: "Xe 6 chỗ ngồi theo đăng ký",
        label: "Xe 6 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 7 chỗ ngồi theo đăng ký",
        label: "Xe 7 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 8 chỗ ngồi theo đăng ký",
        label: "Xe 8 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 9 chỗ ngồi theo đăng ký",
        label: "Xe 9 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 794000,
      },
      {
        value: "Xe 10 chỗ ngồi theo đăng ký",
        label: "Xe 10 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 11 chỗ ngồi theo đăng ký",
        label: "Xe 11 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 12 chỗ ngồi theo đăng ký",
        label: "Xe 12 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 13 chỗ ngồi theo đăng ký",
        label: "Xe 13 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 14 chỗ ngồi theo đăng ký",
        label: "Xe 14 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 15 chỗ ngồi theo đăng ký",
        label: "Xe 15 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 16 chỗ ngồi theo đăng ký",
        label: "Xe 16 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 17 chỗ ngồi theo đăng ký",
        label: "Xe 17 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 18 chỗ ngồi theo đăng ký",
        label: "Xe 18 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 19 chỗ ngồi theo đăng ký",
        label: "Xe 19 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 20 chỗ ngồi theo đăng ký",
        label: "Xe 20 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 21 chỗ ngồi theo đăng ký",
        label: "Xe 21 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 22 chỗ ngồi theo đăng ký",
        label: "Xe 22 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 23 chỗ ngồi theo đăng ký",
        label: "Xe 23 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe 24 chỗ ngồi theo đăng ký",
        label: "Xe 24 chỗ ngồi theo đăng ký",
        baseFeeTNDS: 1270000,
      },
      {
        value: "Xe trên 24 chỗ",
        label: "Xe trên 24 chỗ",
        baseFeeTNDS: 1734000,
      },
    ],
  },
  {
    usage: "Xe ô tô chở hàng (xe tải)",
    label: "Xe ô tô chở hàng (xe tải)",
    vehicleTypes: [
      { value: "Xe dưới 3 tấn", label: "Xe dưới 3 tấn", baseFeeTNDS: 853000 },
      {
        value: "Xe từ 3 đến 8 tấn",
        label: "Xe từ 3 đến 8 tấn",
        baseFeeTNDS: 1660000,
      },
      {
        value: "Xe trên 8 đến 15 tấn",
        label: "Xe trên 8 đến 15 tấn",
        baseFeeTNDS: 2746000,
      },
      {
        value: "Xe trên 15 tấn",
        label: "Xe trên 15 tấn",
        baseFeeTNDS: 3200000,
      },
    ],
  },
  {
    usage: "Xe tập lái",
    label: "Xe tập lái",
    // Tinh bang 120% phi bao hiem cua xe cung loai quy dinh muc IV va muc VI
    vehicleTypes: [
      {
        value: "Xe dưới 6 chỗ ngồi",
        label: "Xe dưới 6 chỗ ngồi",
        baseFeeTNDS: 437000 * 1.2,
      },
      {
        value: "Xe từ 6 đến 11 chỗ ngồi",
        label: "Xe từ 6 đến 11 chỗ ngồi",
        baseFeeTNDS: 794000 * 1.2,
      },
      {
        value: "Xe từ 12 đến 24 chỗ ngồi",
        label: "Xe từ 12 đến 24 chỗ ngồi",
        baseFeeTNDS: 1270000 * 1.2,
      },
      {
        value: "Xe trên 24 chỗ ngồi",
        label: "Xe trên 24 chỗ ngồi",
        baseFeeTNDS: 1825000 * 1.2,
      }, // Cần xác nhận lại công thức phí cụ thể cho loại này
      {
        value: "Xe vừa chở người vừa chở hàng (Pickup, minivan)",
        label: "Xe vừa chở người vừa chở hàng (Pickup, minivan)",
        baseFeeTNDS: 437000 * 1.2,
      },
      { value: "Dưới 3 tấn", label: "Dưới 3 tấn", baseFeeTNDS: 853000 * 1.2 },
      {
        value: "Từ 3 đến 8 tấn",
        label: "Từ 3 đến 8 tấn",
        baseFeeTNDS: 1660000 * 1.2,
      },
      {
        value: "Trên 8 đến 15 tấn",
        label: "Trên 8 đến 15 tấn",
        baseFeeTNDS: 2746000 * 1.2,
      },
      {
        value: "Trên 15 tấn",
        label: "Trên 15 tấn",
        baseFeeTNDS: 3200000 * 1.2,
      },
    ],
  },
  {
    usage: "Xe ô tô chuyên dùng",
    label: "Xe ô tô chuyên dùng",
    // Phi bao hiem cua xe cuu thuong duoc tinh bang 120% phi bao hiem xe con quy dinh tai muc IV.
    // Phi bao hiem cua xe vua cho nguoi vua cho hang quy dinh tai muc V.
    // Phi bao hiem cua xe cho hang duoc tinh bang 120% phi bao hiem cua xe cho hang quy dinh tai muc VI
    // Phi bao hiem cua xe chuyen dung khac tinh bang 100% phi bao hiem cua xe cho hang quy dinh tai muc VI.
    vehicleTypes: [
      {
        value: "Xe cứu thương",
        label: "Xe cứu thương",
        baseFeeTNDS: 290000 * 1.2,
      }, // Dựa trên Xe con
      { value: "Xe chở tiền", label: "Xe chở tiền", baseFeeTNDS: 290000 * 1.2 }, // Tạm coi là xe con chuyên dùng
      {
        value: "Xe ô tô chuyên dùng quy định tải thiết kế dưới 3 tấn",
        label: "Xe ô tô chuyên dùng quy định tải thiết kế dưới 3 tấn",
        baseFeeTNDS: 853000 * 1.2,
      }, // Dựa trên Xe chở hàng
      {
        value: "Xe ô tô chuyên dùng quy định tải thiết kế từ 3 đến 8 tấn",
        label: "Xe ô tô chuyên dùng quy định tải thiết kế từ 3 đến 8 tấn",
        baseFeeTNDS: 1660000 * 1.2,
      }, // Dựa trên Xe chở hàng
      {
        value: "Xe ô tô chuyên dùng quy định tải thiết kế trên 8 đến 15 tấn",
        label: "Xe ô tô chuyên dùng quy định tải thiết kế trên 8 đến 15 tấn",
        baseFeeTNDS: 2746000 * 1.2,
      }, // Dựa trên Xe chở hàng
      {
        value: "Xe ô tô chuyên dùng quy định tải thiết kế trên 15 tấn",
        label: "Xe ô tô chuyên dùng quy định tải thiết kế trên 15 tấn",
        baseFeeTNDS: 3200000 * 1.2,
      }, // Dựa trên Xe chở hàng
      {
        value: "Xe ô tô chuyên dùng không quy định tải thiết kế",
        label: "Xe ô tô chuyên dùng không quy định tải thiết kế",
        baseFeeTNDS: 853000 * 1,
      }, // Dựa trên Xe chở hàng dưới 3 tấn * 100% (cần kiểm tra lại loại xe nền chính xác)
    ],
  },
  {
    usage: "Xe đầu kéo rơ-moóc",
    label: "Xe đầu kéo rơ-moóc",
    // Tinh bang 150% phi bao hiem xe cho hang co trong tai tren 15 tan quy dinh tai muc VI.
    // Phi bao hiem cua xe dau keo ro-mooc la phi cua xe dau keo va ro mooc.
    vehicleTypes: [
      {
        value: "Xe đầu kéo rơ-moóc",
        label: "Xe đầu kéo rơ-moóc",
        baseFeeTNDS: 3200000 * 1.5,
      }, // Dựa trên Xe chở hàng trên 15 tấn
    ],
  },
  {
    usage: "Xe máy kéo",
    label: "Xe máy kéo",
    // Tinh bang 120% phi bao hiem xe cho hang co trong tai duoi 3 tan quy dinh tai muc VI. Phi bao hiem cua may keo la phi bao hiem cua xe may keo va ro mooc.
    vehicleTypes: [
      { value: "Xe máy kéo", label: "Xe máy kéo", baseFeeTNDS: 853000 * 1.2 }, // Dựa trên Xe chở hàng dưới 3 tấn
    ],
  },
  {
    usage: "Xe buýt",
    label: "Xe buýt",
    // Tinh bang phi bao hiem xe kinh doanh van tai cung so cho quy dinh tai muc IV
    vehicleTypes: [
      {
        value: "Xe dưới 6 chỗ ngồi",
        label: "Xe dưới 6 chỗ ngồi",
        baseFeeTNDS: 437000,
      }, // Dựa trên Xe ô tô kinh doanh vận tải dưới 6 chỗ
      {
        value: "Xe từ 6 đến 11 chỗ ngồi",
        label: "Xe từ 6 đến 11 chỗ ngồi",
        baseFeeTNDS: 794000,
      }, // Dựa trên Xe ô tô kinh doanh vận tải 6 đến 11 chỗ
      {
        value: "Xe từ 12 đến 24 chỗ ngồi",
        label: "Xe từ 12 đến 24 chỗ ngồi",
        baseFeeTNDS: 1270000,
      }, // Dựa trên Xe ô tô kinh doanh vận tải 12 đến 24 chỗ
      {
        value: "Xe trên 24 chỗ ngồi",
        label: "Xe trên 24 chỗ ngồi",
        baseFeeTNDS: 1825000,
      }, // Dựa trên Xe ô tô kinh doanh vận tải trên 24 chỗ (cần xác nhận lại công thức phí)
    ],
  },
  {
    usage: "Sử dụng cá nhân",
    label: "Sử dụng cá nhân",
    // Tạm thời mapping sang loại xe con chung
    vehicleTypes: [
      { value: "Xe con", label: "Xe con", baseFeeTNDS: 290000 }, // Dựa trên Các loại xe con lại
    ],
  },
] as const;

// Hàm helper để lấy danh sách loại xe dựa trên mục đích sử dụng
export const getVehicleTypesByUsage = (usagePurpose: string) => {
  const purposeData = CAR_INSURANCE_DATA.find(
    (data) => data.usage === usagePurpose
  );
  return purposeData ? purposeData.vehicleTypes : [];
};

// Hàm helper để lấy phí TNDS dựa trên mục đích sử dụng và loại xe
export const getTNDSFee = (
  usagePurpose: string,
  vehicleType: string
): number => {
  const purposeData = CAR_INSURANCE_DATA.find(
    (data) => data.usage === usagePurpose
  );
  if (!purposeData) return 0;

  const vehicleTypeData = purposeData.vehicleTypes.find(
    (type) => type.value === vehicleType
  );
  return vehicleTypeData ? vehicleTypeData.baseFeeTNDS : 0;
};

// Phí bảo hiểm tai nạn phụ xe (0.2%)
export const PASSENGER_ACCIDENT_FEE_RATE = 0.002;

// Hàm tính tổng phí bảo hiểm
export const calculateTotalInsuranceFee = (
  usagePurpose: string,
  vehicleType: string,
  insuranceTerm: number,
  accidentCoverage: number
): {
  tndsFee: number;
  passengerAccidentFee: number;
  totalFee: number;
} => {
  // 1. Tính phí TNDS cơ bản (1 năm)
  let baseTndsFee = getTNDSFee(usagePurpose, vehicleType);

  // Áp dụng hệ số thời hạn bảo hiểm (nếu khác 1 năm) - Giả định công thức chung là tỷ lệ thuận theo số năm
  // LƯU Ý: Nghị định 67 có công thức riêng cho thời hạn dưới 1 năm (tối thiểu 60% phí năm). Cần điều chỉnh nếu hỗ trợ thời hạn dưới 1 năm.
  const annualTndsFee = baseTndsFee * insuranceTerm;

  // Thêm 10% VAT cho phí TNDS
  const tndsFeeWithVAT = annualTndsFee * 1.1;

  // 2. Tính phí bảo hiểm tai nạn phụ xe
  const passengerAccidentFee = accidentCoverage * PASSENGER_ACCIDENT_FEE_RATE;

  // 3. Tính tổng phí
  const totalFee = tndsFeeWithVAT + passengerAccidentFee;

  return {
    tndsFee: tndsFeeWithVAT, // Phí TNDS sau VAT và theo thời hạn
    passengerAccidentFee: passengerAccidentFee, // Phí tai nạn
    totalFee: totalFee, // Tổng cộng
  };
};
